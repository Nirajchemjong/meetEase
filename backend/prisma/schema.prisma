generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id              Int           @id @default(autoincrement())
  email           String        @unique
  name            String?
  picture         String?
  google_account_id String?
  access_token    String
  refresh_token   String?
  token_expiry    DateTime?
  created_at      DateTime      @default(now())
  updated_at      DateTime      @default(now())

  event_types     event_types[]
  availabilities  availabilities[]
  contacts        contacts[]
  events          events[]
}

model event_types {
  id               Int      @id @default(autoincrement())
  user_id          Int
  title            String
  description      String?
  duration_minutes Int
  is_active        Boolean  @default(true)
  client_tag       String?
  created_at       DateTime @default(now())
  updated_at       DateTime @default(now())

  users            users     @relation(fields: [user_id], references: [id])
  events           events[]
}

model availabilities {
  id          Int      @id @default(autoincrement())
  user_id     Int
  day_of_week Int
  start_time  DateTime @db.Time
  end_time    DateTime @db.Time
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())

  users       users    @relation(fields: [user_id], references: [id])
  @@unique([user_id, day_of_week, start_time, end_time], name: "user_day_time_unique")
}

model contacts {
  id         Int      @id @default(autoincrement())
  user_id    Int
  name       String
  email      String
  phone      String?
  tag        String?
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  users      users    @relation(fields: [user_id], references: [id])
  events     events[]
  @@unique([user_id, email], name: "contacts_user_id_email_unique")
}

model events {
  id               Int      @id @default(autoincrement())
  user_id          Int
  event_type_id    Int
  contact_id       Int?
  start_at         DateTime
  end_at           DateTime
  timezone         String
  location_link    String
  status           String
  calendar_event_id String  @unique
  description      String?
  is_rescheduled   Boolean  @default(false)
  created_at       DateTime @default(now())
  updated_at       DateTime @default(now())

  users        users        @relation(fields: [user_id], references: [id])
  event_types  event_types  @relation(fields: [event_type_id], references: [id])
  contacts     contacts?    @relation(fields: [contact_id], references: [id])
}
